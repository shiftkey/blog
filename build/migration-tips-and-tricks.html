---
layout: build
title: Notes from BUILD
---

<header>
	<h2>Recap from BUILD</h2>
</header>

<article>
    <header>
        <h3>API Design and Windows Metadata Exporter</h3>
    </header>

    <section>
        I spent today migrating an existing .NET library (Stacky - details <a href="http://stacky.codeplex.com/">here</a>) into a Windows Runtime-compatible API. While I started out with the goal of having one codebase to rule them all, I quickly found this was awfully idealistic and focused on just the WinRT stuff as an exercise. <br />
        <br />
        You can see the state of the code (warning: very rough) on <a href="https://bitbucket.org/shiftkey/stackywinrt">bitbucket</a>.
    </section>

    <section>
    <header>
        <h4>Caveats</h4>
    </header>
        All of this remarks below are subject to change. I have a few outstanding queries which I'll follow up with the product teams as I can find them on Twitter or on the forums.
    </section>

    <section>
        <header>
           <h4> What worked</h4>
        </header>

        Not much -  but I was unsurprised by that as there were many design decisions which were flagged at BUILD. I'll refer to some of the sessions I've watched from BUILD about this:

        <ul>
            <li>Talk 1</li>
            <li>Talk 1</li>
            <li>Talk 1</li>
        </ul>
    </section>

    <section>
        <header>
           <h4>Why the change?</h4>
        </header>

        A fair few - but again, is to be expected. The move to asychronous methods which can be invoked synchronously thanks to the syntactical sugar of <code>await</code> and <code>async</code> keywords demands this, but does have a lot of benefits.

        <br /><br />

        For people who have been doing .NET development, they should be familiar with the concept of a class library - a reusable set of classes which can be referenced in other projects.<br /><br />

        The Windows Runtime APIs behave slightly different (more on this later) and requires a different build process. Why do this? If you want your library to be consumed from C++ or a Javascript WinRT applications. Again, this is a topic far better covered by the product teams at BUILD, so go check them out.<br /><br />

        {% img center /img/posts/Win8/project-settings.png  %} <br /><br />

        When I change my project type to output a WinMD file, this changes the build process to include a tool called <strong>Windows Metadata Exporer</strong> (herein referred to as <strong>winmdexp</strong>). <br /><br />

        {% img center /img/posts/Win8/winmdexp-output.png %} <br /><br />

        You won't see this level of detail in your Output Window unless you switch the MSBuild output under <strong>Tools | Options | Projects and Solutions | Build and Run</strong> to Diagnostic or higher.<br /><br />

        You will see the errors and warnings though: <br /><br />
        
        {% img center /img/posts/Win8/error-output.png %} <br /><br />
        
    </section>
    <section>
        <header>
           <h4>Why the change?</h4>
        </header>

    </section>

    <section>
        <header>
        <h4>Public (or protected) generic methods</h4>
        </header>

        {% blockquote %}
        <strong>Error:</strong> Generic type parameters may not appear in method signatures of Windows Runtime methods.
        {% endblockquote %}
        <pre>
        protected void NotifyOfPropertyChange&lt;TProperty&gt;(Expression&lt;Func&lt;TProperty&gt;&gt; property)
        {
            NotifyOfPropertyChange(property.GetMemberInfo().Name);
        }
        </pre>

        <strong>Resolution: mark this as internal. Public or Protected</strong>
    </section>

     <section>
        <h4>Use an interface instead of an implementation</h4>
{% blockquote %}
        <strong>Error:</strong> Although this type is not a valid Windows Runtime type, it implements interfaces which are valid Windows Runtime types.
{% endblockquote %}
        Consider changing the method signature to instead use one of the following types: 'System.Collections.Generic.IList<MyClass>, System.Collections.Generic.IReadOnlyList<MyClass>, System.Collections.Generic.IEnumerable<MyClass>'
    </section>

    <section>
          
        <strong>Error:</strong> Type 'MyClass' is unsealed but is not enabled for composition. Either seal 'MyClass', or mark it with the System.Runtime.InteropServices.WindowsRuntime.EnableCompositionAttribute so that you can derive from it. To use the class from JavaScript, you must seal it.
    </section>

    <section>
        <strong>Error:</strong>'MyClass.Method(System.Object parameter)' is a virtual method. Managed types may not expose new virtual methods in Windows Runtime.

        <strong>Error: </strong>Field names cannot differ only by case: 'Stacky.User.webSite' , 'Stacky.User.website'.

        <strong>Error: </strong>Interface 'Stacky.IPagedList<T>' requires interface 'System.Collections.Generic.IEnumerable<T>' which is not a Windows Runtime interface.  Exported interfaces may only require other Windows Runtime interfaces.

Field names cannot differ only by case: 'Namespace.Class.<PROPERTY>k__BackingField' , 'Stacky.ErrorResponse.<Property>k__BackingField'.	

     <strong>Error: </strong>	Unable to determine a default interface for runtime class 'Stacky.TagWiki'.  The class does not implement any interfaces, and no interface was generated for it because it does not contain any public methods, properties, or events.

<strong>Error: </strong>Unable to determine a default interface for runtime class 'Stacky.HttpResponse'.  The class does not implement any interfaces, and no interface was generated for it because it does not contain any public methods, properties, or events.	C:\Code\codeplex\shiftkey\stackywinrt\trunk\source\Stacky.WinRT\obj\Debug\Stacky.WinRT.winmdobj	Stacky.WinRT





    </section>

    </article>


