<?xml version="1.0"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
    <title>brendan forster.com</title>
    <link>http://brendanforster.com/</link>
    <atom:link href="http://brendanforster.com/rss.xml" rel="self" type="application/rss+xml" />
    <description></description>
    <language>en-au</language>
    <pubDate>Sun, 23 Oct 2011 23:04:03 +1100</pubDate>
    <lastBuildDate>Sun, 23 Oct 2011 23:04:03 +1100</lastBuildDate>

    
    <item>
      <title>I'm speaking at DDD Brisbane</title>
      <link>http://brendanforster.comddd-brisbane.html</link>
      <pubDate>Sun, 23 Oct 2011 00:00:00 +1100</pubDate>
      <author>shift.key@gmail.com (Brendan Forster)</author>
      <guid>http://brendanforster.com./ddd-brisbane</guid>
      <description>&lt;p&gt;&lt;img src='/img/main/metro-preview.png' width='400' height='300' alt='' title='' style='float: right;margin-left: 1.5em;'&gt;&lt;/p&gt;

&lt;p&gt;The &lt;a href=&quot;http://dddbrisbane.com&quot;&gt;dddBrisbane&lt;/a&gt; organisers sent out a call over the weekend to finalise the schedule - some very cool talks that I'm looking forward to seeing (look for the schedule to appear early this week).&lt;/p&gt;

&lt;p&gt;I'm especially honoured to see my session was picked - especially after seeing the depth of Windows 8 talks submitted.&lt;/p&gt;

&lt;p&gt;So what am I talking about?&lt;/p&gt;

&lt;h2&gt;Windows 8 - Who Moved My Cheese?&lt;/h2&gt;

&lt;p&gt;I'll link back to my abstract once I remember what I submitted, but keep in mind there is another Windows 8 session in the mix - so I'll probably tweak the script to prevent overlap.&lt;/p&gt;

&lt;p&gt;What shall we discuss?&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt; what is this Windows Runtime thing?&lt;/li&gt;
&lt;li&gt; when should I go full metro? and what's classic mode?&lt;/li&gt;
&lt;li&gt; how do I do X with Windows Runtime?&lt;/li&gt;
&lt;li&gt; what new feature does Windows Runtime bring?&lt;/li&gt;
&lt;li&gt; how do I wrap my head around doing client apps in HTML/JS?&lt;/li&gt;
&lt;li&gt; tips and tricks for maintainable code&lt;/li&gt;
&lt;li&gt; ...&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I'll add links to the content after the talk, so check back for more details.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://dddbrisbane.com/register&quot;&gt;Registration&lt;/a&gt; is only $25, and the DDD events are always a fun day (especially the after-party, if you can hang around for that).&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Doing the build server dance with NuGet</title>
      <link>http://brendanforster.comdoing-the-build-server-dance-with-nuget.html</link>
      <pubDate>Fri, 08 Jul 2011 14:00:00 +1000</pubDate>
      <author>shift.key@gmail.com (Brendan Forster)</author>
      <guid>http://brendanforster.com./doing-the-build-server-dance-with-nuget</guid>
      <description>&lt;p&gt;I started exploring NuGet package building yesterday evening, as a strategy for managing dependencies between projects I'm involved with.&lt;/p&gt;

&lt;p&gt;And with NuGet in the enterprise being the &lt;a href=&quot;http://www.hanselman.com/blog/NuGetForTheEnterpriseNuGetInAContinuousIntegrationAutomatedBuildSystem.aspx&quot;&gt;upcoming hotness&lt;/a&gt;, I thought I'd see how I could get companies I work with to start doing similar things with their internal projects. It was much easier than I'd expected, with a couple of hurdles.&lt;/p&gt;

&lt;h2&gt;The Goal&lt;/h2&gt;

&lt;p&gt;I have two projects, A and B. A has no upstream dependencies (that have NuGet packages, anyway), but B requires A.&lt;/p&gt;

&lt;p&gt;So, after A builds and passes its tests, I want to:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Create a new package for A, using it's build number.&lt;/li&gt;
&lt;li&gt;Publish the package for A somewhere&lt;/li&gt;
&lt;li&gt;Trigger a new build for B, using the newest version of A.&lt;/li&gt;
&lt;li&gt;Verify B builds and passes tests.&lt;/li&gt;
&lt;li&gt;Create a new package for B, using it's build number.&lt;/li&gt;
&lt;li&gt;Publish the package for B somewhere.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;After a couple of hours work, I'm 95% of the way there.&lt;/p&gt;

&lt;h2&gt;Defining the package specification&lt;/h2&gt;

&lt;p&gt;As I wasn't really familiar with the process of creating the .nuspec file (sorry &lt;a href=&quot;http://twitter.com/damianedwards&quot;&gt;Damo&lt;/a&gt;, your NDC talk was a long time ago :)) I decided to go and craft it by hand. I used this &lt;a href=&quot;http://lostechies.com/joshuaflanagan/2011/06/23/tips-for-building-nuget-packages/&quot;&gt;blog post&lt;/a&gt; by &lt;a href=&quot;http://twitter.com/jflanagan&quot;&gt;Joshua Flanagan&lt;/a&gt; (including a good reference &lt;a href=&quot;https://github.com/DarthFubuMVC/bottles/blob/6d82e063fd889ac1909c98adc369a97b4c1e377e/packaging/nuget/bottles.nuspec&quot;&gt;nuspec file&lt;/a&gt;) to get started.&lt;/p&gt;

&lt;p&gt;And that's about it. Put that into my build folder along with the NuGet.exe - I grabbed the latest one from the 1.4 OOB build on &lt;a href=&quot;http://ci.nuget.org:8080/&quot;&gt;NuGet CI server&lt;/a&gt; due to an issue with how it parses the &amp;lt;files&amp;gt; element. This should be part of the next release.&lt;/p&gt;

&lt;h2&gt;Building the package on the server&lt;/h2&gt;

&lt;p&gt;So, I'm using TeamCity to build the project. Thus, I can use the build number directly against the NuGet package.&lt;/p&gt;

&lt;p&gt;NOTE: Using the default value TeamCity provides for a project, which is just an incrementing integer, will fail with a &quot;Version string portion was too short or too long&quot; error. To fix that, go to General Settings and make it something more descriptive:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;img/posts/NuGet/BuildNumber.png&quot; alt=&quot;General Settings&quot; /&gt;&lt;/p&gt;

&lt;p&gt;With that in place, the next step is to add in a post-build step:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/img/posts/NuGet/PackageStep.png&quot;&gt;&lt;img src=&quot;/img/posts/NuGet/PackageStep-Small.png&quot; alt=&quot;Post Build Step&quot; /&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;The script I've used (duplicated for two different packages):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;del *.nupkg

.\NuGet.exe pack Package.nuspec -Version %system.build.number%
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That script is courtesy of Scott Kirkland, who also has a decent guide to using NuGet on TC &lt;a href=&quot;http://weblogs.asp.net/srkirkland/archive/2011/03/29/deploy-nuget-packages-during-ci-build-with-teamcity.aspx&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;h2&gt;Publishing the package&lt;/h2&gt;

&lt;p&gt;I didn't want to publish these packages to the NuGet gallery immediately, so what other options do I have? I could set up my own NuGet gallery. Or I could use &lt;a href=&quot;http://www.myget.org/&quot;&gt;MyGet&lt;/a&gt; and skip all the hassle.&lt;/p&gt;

&lt;p&gt;For those who aren't familiar with MyGet, its a service to create custom NuGet feeds. All I've done so far is create a private feed (which anyone can consume) and obtained an API key.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;img/posts/NuGet/myget.png&quot;&gt;&lt;img src=&quot;img/posts/NuGet/myget-small.png&quot; alt=&quot;Post Build Step&quot; /&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;While MyGet supports the ability to upload or create packages within the admin UI, I was feeling lazy and wanted to push packages from the build server.&lt;/p&gt;

&lt;p&gt;This required an additional line in the script:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;del *.nupkg

.\NuGet.exe pack Package.nuspec -Version %system.build.number%

forfiles /m *.nupkg /c &quot;cmd /c NuGet.exe push @FILE &amp;lt;your-key&amp;gt; -Source https://www.myget.org/F/mahapps/&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;which will find all .nupkg files and invoke &lt;em&gt;push&lt;/em&gt; against the specific repository - in this case, my private feed.&lt;/p&gt;

&lt;h2&gt;Trigger a new build&lt;/h2&gt;

&lt;p&gt;This isn't directly related to NuGet, but I wanted to force a new build when upstream packages change in TeamCity.&lt;/p&gt;

&lt;p&gt;Under Build Triggering in the Project Configuration, add a trigger for &quot;Finish Build&quot; and select the upstream project.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;img/posts/NuGet/buildtriggering.png&quot;&gt;&lt;img src=&quot;img/posts/NuGet/buildtriggering-small.png&quot; alt=&quot;Add Build Trigger&quot; /&gt;&lt;/a&gt;&lt;/p&gt;


&lt;h2&gt;Update the package for A and test&lt;/h2&gt;

&lt;p&gt;Right, this is where things get rough.&lt;/p&gt;

&lt;p&gt;I added a step before building the project, and executed this command:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;.\Nuget.exe update ..\MahApps.Twitter.sln -Source http://www.myget.org/f/mahapps
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;which will look through all the projects in my solution and update to the newest packages it can find. I've added in my MyGet feed URL to grab the latest packages from the specific feed.&lt;/p&gt;

&lt;p&gt;And this works. Kinda.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;img/posts/NuGet/updatescripts.png&quot;&gt;&lt;img src=&quot;img/posts/NuGet/updatescripts-small.png&quot; alt=&quot;Success?&quot; /&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;It updates my projects, but doesn't store updated packages locally.
Which causes my build to break.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;img/posts/NuGet/compileerrors.png&quot;&gt;&lt;img src=&quot;img/posts/NuGet/compileerrors-small.png&quot; alt=&quot;Oops&quot; /&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Scouring the forums produced &lt;a href=&quot;http://nuget.codeplex.com/discussions/264082&quot;&gt;this discussion&lt;/a&gt; on this issue, which recommended this workaround:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;nuget install MyProj\packages.config -o packages
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt;: a minor grievance with the &lt;em&gt;install&lt;/em&gt; command. Unlike the &lt;em&gt;update&lt;/em&gt; command, this works against a project's repository. This seems subpar, when I can call &lt;em&gt;update&lt;/em&gt; against a solution file. Can we get some consistency with this? Or have I missed something with how install behaves?&lt;/p&gt;

&lt;p&gt;Fine, not all workarounds are pretty.&lt;/p&gt;

&lt;p&gt;Let's modify my script to suit:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;.\Nuget.exe update ..\MahApps.Twitter.sln -Source http://www.myget.org/f/mahapps -Source https://go.microsoft.com/fwlink/?LinkID=206669 -o ..\packages

.\Nuget.exe install ..\src\Identica\packages.config -Source http://www.myget.org/f/mahapps -Source https://go.microsoft.com/fwlink/?LinkID=206669 -o ..\packages

.\Nuget.exe install ..\src\NET4\packages.config -Source http://www.myget.org/f/mahapps -Source https://go.microsoft.com/fwlink/?LinkID=206669 -o ..\packages

.\Nuget.exe install ..\src\Tests\packages.config -Source http://www.myget.org/f/mahapps -Source https://go.microsoft.com/fwlink/?LinkID=206669 -o ..\packages

.\Nuget.exe install ..\src\WP7\packages.config -Source http://www.myget.org/f/mahapps -Source https://go.microsoft.com/fwlink/?LinkID=206669 -o ..\packages
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Icky. Whatever, I've got awesome to do.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;https://go.microsoft.com/fwlink/?LinkID=206669&lt;/em&gt; is the path to the official NuGet feed (the build server couldn't find some packages), and it is explicitly after my local feed (I may have some custom packages which I prefer). And I've added the &quot;-o&quot; parameter to point to the default packages location, just in case.&lt;/p&gt;

&lt;p&gt;Aaaaand...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;img/posts/NuGet/installedpackages.png&quot;&gt;&lt;img src=&quot;img/posts/NuGet/installedpackages-small.png&quot; alt=&quot;Success!&quot; /&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Booyah!&lt;/p&gt;

&lt;h2&gt;TODO&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;submit patch for making update more &quot;correct&quot; ?&lt;/li&gt;
&lt;li&gt;demonstrate how to add to VS tooling and how it changes dev story&lt;/li&gt;
&lt;li&gt;some documentation on managing upstream dependencies&lt;/li&gt;
&lt;/ul&gt;

</description>
    </item>
    
    <item>
      <title>Soapbox: INotifyPropertyChanged - Stop the Madness</title>
      <link>http://brendanforster.cominotifypropertychanged-stop-the-madness.html</link>
      <pubDate>Sat, 18 Jun 2011 14:00:00 +1000</pubDate>
      <author>shift.key@gmail.com (Brendan Forster)</author>
      <guid>http://brendanforster.com./inotifypropertychanged-stop-the-madness</guid>
      <description>&lt;p&gt;Its time to stop with this madness.&lt;/p&gt;

&lt;p&gt;Apologies again to &lt;a href=&quot;http://twitter.com/kiwipom&quot;&gt;Ian&lt;/a&gt; as I picked on him unnecessarily when I read yet another &quot;Let's make OnPropertyChanged compile safe&quot; &lt;a href=&quot;http://xaml.geek.nz/binding/5&quot;&gt;blog post&lt;/a&gt; yesterday.&lt;/p&gt;

&lt;p&gt;I don't have an issue with the approach, but I had an issue with the bigger picture - how little had changed for XAML developers in this regard. Keep in mind that lambdas were first made available in C# 3.0 - which itself was made available in 2007, with .NET 3.5.&lt;/p&gt;

&lt;p&gt;I've been summoned into this debate &lt;a href=&quot;http://www.mail-archive.com/ozdotnet@ozdotnet.com/msg03903.html&quot;&gt;before&lt;/a&gt; (and was assumed to be a &quot;cool kid&quot;) so I thought I'd put down some thoughts on the issue, and what I think needs to change:&lt;/p&gt;

&lt;h2&gt;Stop writing plumbing code&lt;/h2&gt;

&lt;p&gt;Every time you write logic in the setter of a property, an angel disappoints her family by taking up stripping.&lt;/p&gt;

&lt;p&gt;There have been compelling reasons to do so. After dealing with the resulting pain, I've explored other options to take all those needs away. So let's break it down:&lt;/p&gt;

&lt;p&gt;To start off with the &lt;em&gt;worst&lt;/em&gt; case scenario, we have:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;private string _someProperty;
public string SomeProperty
{
    get { return _someProperty; }
    set 
    { 
        _someProperty = value;
        OnPropertyChanged(&quot;SomeProperty&quot;);
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3&gt;Make it refactor-friendly - let's use a lambda instead!&lt;/h3&gt;

&lt;p&gt;Yes, this is better than magic strings - that's about it. Don't you get that sinking feeling when adding a new property to the viewmodel, and the code inside the setter looks almost identical to all the others?&lt;/p&gt;

&lt;p&gt;So let's change the property to look like:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;private string _someProperty;
public string SomeProperty
{
    get { return _someProperty; }
    set 
    { 
        _someProperty = value;
        OnPropertyChanged(() =&amp;gt; SomeProperty);
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;For an example implementation that accepts lambda statements, &lt;a href=&quot;http://stackoverflow.com/questions/141370/inotifypropertychanged-property-name-hardcode-vs-reflection/1209104#1209104&quot;&gt;this Stackoverflow answer&lt;/a&gt; is a good starting point.&lt;/p&gt;

&lt;h3&gt;I only want to raise the change when the backing value actually changes!&lt;/h3&gt;

&lt;p&gt;&quot;Wait,&quot; the audience exlaims in shock, &quot;you're going to raise the event each time now.&quot; The author relents, and adds some code to end the pain for the audience:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;private string _someProperty;
public string SomeProperty
{
    get { return _someProperty; }
    set 
    { 
        if (_someProperty == value)
            return;

        _someProperty = value;
        OnPropertyChanged(() =&amp;gt; SomeProperty);
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I'd better ensure this is defined in all the setters, and that the right backing field is used in each case. I'd look pretty silly if I'd used the wrong field, like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;// elsewhere in the codebase
private string _someOtherProperty;

// ...

private string _someProperty;
public string SomeProperty
{
    get { return _someProperty; }
    set 
    { 
        if (_someOtherProperty == value)
            return;

        _someProperty = value;
        OnPropertyChanged(() =&amp;gt; SomeProperty);
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;so I'd better do it real carefully...&lt;/p&gt;

&lt;h3&gt;We need caching now!&lt;/h3&gt;

&lt;p&gt;Really? That's what comes to mind next? You crazy developers.&lt;/p&gt;

&lt;p&gt;Fine, let's add a dictionary to capture the event arguments, instead of recreating them each time (adapted from this &lt;a href=&quot;http://www.paulstovell.com/strong-property-names&quot;&gt;blog post&lt;/a&gt;):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;public class ViewModelBase
{
    protected void OnPropertyChanged(Expression&amp;lt;Func&amp;lt;object&amp;gt;&amp;gt; lambda)
    {
        // Go read Paul (and especially Miguel's comment) about this [here][6]. I'll wait...
    }

    private IDictionary&amp;lt;string, PropertyChangedEventArgs&amp;gt; _handlers = new Dictionary&amp;lt;string, PropertyChangedEventArgs&amp;gt;      

    protected void OnPropertyChanged(string propertyName)
    {
        PropertyChangedEventArgs args;

        if (!_handlers.ContainsKey(propertyName))
        {
            _handlers.Add(propertyName, new PropertyChangedEventArgs(propertyName));
        }

        args = _handlers[propertyName];

        PropertyChanged(this, args);
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Have we saved much? Perhaps. Perhaps not...&lt;/p&gt;

&lt;h3&gt;Wait, what about cross-thread issues? I do a lot on the background thread!&lt;/h3&gt;

&lt;p&gt;Ah yes. Have you ever been bitten by this one - a background thread updates a property, which triggers the PropertyChanged event, which asplodes because the UI can only be updated from the main thread?&lt;/p&gt;

&lt;h2&gt;Stop. Put down the keyboard for a minute.&lt;/h2&gt;

&lt;p&gt;See how quickly all these features around INotifyPropertyChanged can spiral out of control? You've worked out the code and classes necessary to solve a common problem, but some overhead remains for writing boilerplate code everywhere the solution is required. And while it is a manual process, it is prone to human error.&lt;/p&gt;

&lt;p&gt;Go back and read that last sentence again. Did something click about what you've been doing all along with INotifyPropertyChanged?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/posts/Achievement.jpg&quot; alt=&quot;Huzzah!&quot; /&gt;&lt;/p&gt;

&lt;h2&gt;A what?&lt;/h2&gt;

&lt;p&gt;INotifyPropertyChanged is a very specialised example of a cross-cutting concern.&lt;/p&gt;

&lt;p&gt;We use INotifyPropertyChanged in many places when doing XAML-based applications - as it is critical when databinding POCO objects without requiring the use of DependencyProperty instances. Although we spent a lot of time optimising the behaviour of invoking INotifyPropertyChanged, we didn't improve &lt;strong&gt;how&lt;/strong&gt; this code is used - we're still copying-and-pasting the same code around, and having to make manual changes to each instance to suit the property.&lt;/p&gt;

&lt;p&gt;We need the ability to apply the INotifyPropertyChanged behaviour in an automatic way. Of course, there are various tradeoffs to consider - which I'll outline from my experiences.&lt;/p&gt;

&lt;h2&gt;What Next?&lt;/h2&gt;

&lt;p&gt;I need to wrap this post up before it becomes even longer, so until my next post - where I'll discuss how AOP flips all this discussion on its ear - readers can get ahead by reading these links:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Sacha Barber - &lt;a href=&quot;http://www.codeproject.com/KB/library/Aspects.aspx&quot;&gt;Aspect Examples (INotifyPropertyChanged via Aspects)&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://twitter.com/philiplaureano&quot;&gt;Philip Laureano&lt;/a&gt; linked me this yesterday. A large read, but lots of demo code for people who want to see something more concrete.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;http://code.google.com/p/notifypropertyweaver/&quot;&gt;NotifyPropertyWeaver&lt;/a&gt; - a .NET library for weaving INotifyPropertyChanged code into IL&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;This is my library of choice for automating INotifyPropertyChanged usage. I definitely owe &lt;a href=&quot;http://twitter.com/simoncropp&quot;&gt;Simon&lt;/a&gt; a beer (or drink of choice) next time we cross paths - its been a joy to use.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>On the Windows 8 Preview Video</title>
      <link>http://brendanforster.comon-the-windows-8-preview.html</link>
      <pubDate>Wed, 08 Jun 2011 14:00:00 +1000</pubDate>
      <author>shift.key@gmail.com (Brendan Forster)</author>
      <guid>http://brendanforster.com./on-the-windows-8-preview</guid>
      <description>&lt;p&gt;For those who haven't seen it, this video was announced last week about how the Windows 8 UI is changing: &lt;a href=&quot;http://www.youtube.com/watch?v=p92QfWOw88I&quot;&gt;http://www.youtube.com/watch?v=p92QfWOw88I&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It was the trigger for significant backlash - and not for what was said, but for what wasn't said around the other options available for building Windows applications.&lt;/p&gt;

&lt;h2&gt;Yes, MSFT could have handled it better&lt;/h2&gt;

&lt;p&gt;Since the video dropped, developers and possibly everyone with a blog has been raising concerns about the other options available to developers for building Windows apps. The underlying vibe has been &quot;everything else has been abandoned, the only option is now HTML5, the sky is falling and I have nothing to wear&quot;. I haven't watched the Sinofsky video (if it was even recorded), but when you see reporting like:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&quot;The development platform is based on HTML5 and JavaScript.&quot; &lt;a href=&quot;http://news.cnet.com/8301-31021_3-20068119-260/sinofsky-shows-off-windows-8-at-d9/&quot;&gt;Source&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;and constrast with a different source:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&quot;Windows 8 essentially supports two kinds of applications. One is the classic Windows application, which runs in a desktop very similar to the Windows 7 desktop.&quot; &lt;a href=&quot;http://allthingsd.com/20110601/exclusive-making-sense-of-what-we-just-learned-about-windows-8/&quot;&gt;Source&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;then you know something got lost in the message.&lt;/p&gt;

&lt;h2&gt;The sky is falling for &lt;em&gt;insert technology here&lt;/em&gt;&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://forums.silverlight.net/forums/t/230502.aspx&quot;&gt;That thread&lt;/a&gt;. Oh dear $deity, &lt;a href=&quot;http://forums.silverlight.net/forums/p/230725/563975.aspx&quot;&gt;that thread&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I appreciate that the MSFT guys &quot;in the field&quot; are stuck between a rock and a hard place currently - they cannot provide details to answer people's concerns or questions, but are dealing with a large backlash due to the large amount that is not know currently.&lt;/p&gt;

&lt;p&gt;As one of those in the audience who has to wait, in uncertainty, between now and &lt;a href=&quot;http://www.buildwindows.com/&quot;&gt;BUILD&lt;/a&gt; to have these questions answered, I wish they would rethink this decision and respond to questions and help change the course of discussion.&lt;/p&gt;

&lt;p&gt;While the video does mention:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&quot;Windows 8 also runs the existing Windows apps that you know and that you love&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;it then follows up with running Excel.&lt;/p&gt;

&lt;p&gt;Yep. Excel.&lt;/p&gt;

&lt;p&gt;While an Excel demo is a good indicator of the backwards compatibility that Windows is famous for, it was a jarring change from the rest of the video, and I'm not sure it was the best application to demonstrate.&lt;/p&gt;

&lt;p&gt;Perhaps the developer story is not ready to show. Perhaps it was supposed to be about the shell, and HTML5 was only mentioned in passing. Perhaps, perhaps, perhaps. I suspect a demonstration of how a WPF/SL/Winforms/native application &lt;strong&gt;could&lt;/strong&gt; look/feel/behave within the new shell would provide some information without giving much away.&lt;/p&gt;

&lt;p&gt;The video was about creating interest in the new platform and discussing the opportunities it provides. Now is the time to talk more broadly, while everyone is talking about it.&lt;/p&gt;

&lt;p&gt;So instead of &lt;a href=&quot;http://forums.silverlight.net/forums/t/230744.aspx&quot;&gt;drumming up more drama&lt;/a&gt;, I thought I'd share some takeaways for both sides on this:&lt;/p&gt;

&lt;h2&gt;Devs: pay attention to the user experience&lt;/h2&gt;

&lt;p&gt;I hope developers took away from this story how the user experience of applications has changed, and how the classic WIMP (Windows, Icons, Menu, Pointer) applications will be impacted. Much like the transition from Windows Mobile 6.5 to Windows Phone 7, I anticipate some growing pains once developers get their hands on the development tools.&lt;/p&gt;

&lt;p&gt;Touch input is also something that many Windows developers may not be familiar with. While it has been available to native developers since Windows 7 launched, and was added to WPF and Silverlight with subsequent product releases, it hasn't really been utilized to anywhere near its full potential.&lt;/p&gt;

&lt;p&gt;Get familiar with how gestures work - as a starting point, the WP7 emulator turns mouse inputs into touch inputs. Touch will be mandatory if you want an application to be usable on different form factors (Windows 8 is taking an iOS-ish route with the same codebase running on desktops, tablets and devices).&lt;/p&gt;

&lt;h2&gt;MSFT: don't let the echo chamber continue&lt;/h2&gt;

&lt;p&gt;I'm still baffled by the decision to stonewall. Developers are customers, and they have questions. Why not be pro-active and help smooth the transition over the coming months?&lt;/p&gt;

&lt;p&gt;With all the strong and passionate opinions flying around, wouldn't it be good to plant some seeds of confidence and turn the conversation from &quot;Where is XYZ?&quot; to &quot;What can I do with Windows 8 using XYZ?&quot;&lt;/p&gt;

&lt;p&gt;Give the community a baseline of information so they can start planning and start providing feedback. It doesn't have to be revealing all the cards, but the developer story for Windows 8 is (mostly) unknown currently. That's why people are concerned.&lt;/p&gt;

&lt;h2&gt;MSFT: don't forget the hardware&lt;/h2&gt;

&lt;p&gt;I've been looking for a kick-arse tablet device to run Windows on for a while, but have been stuck in Goldilocks-mode - &quot;too large, too heavy, the battery is too short, etc&quot; - and continue to sit on the fence. Much like with WP7, I'm curious about the involvement of hardware vendors to support the new features coming in Windows 8.&lt;/p&gt;

&lt;p&gt;Windows 7 was launched with support for touch input, but it never really gained traction due to lack of a compelling tablet device - the Touchsmarts were a nice device, but were primarily for kiosks, rather than daily usage.&lt;/p&gt;

&lt;p&gt;Compare Windows 7 to the WP7 launches - which have been done with device announcements involving hardware vendors - and it gives me hope that the launch can be done in a more &quot;complete&quot; fashion.&lt;/p&gt;

&lt;p&gt;And I want to see more presentations from MSFT about Windows 8 using touch - drive the presentations from a tablet, demonstrate how the new UI supports touch, and compel me to put it everywhere.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>slsvcutil - Workaround StackOverflowException</title>
      <link>http://brendanforster.comslsvcutil-stackoverflowexception-workaround.html</link>
      <pubDate>Fri, 06 May 2011 14:00:00 +1000</pubDate>
      <author>shift.key@gmail.com (Brendan Forster)</author>
      <guid>http://brendanforster.com./slsvcutil-stackoverflowexception-workaround</guid>
      <description>&lt;p&gt;I've hit this issue before, but it took a bit of googling to remember the fix - especially since that little site called &lt;a href=&quot;http://www.stackoverflow.com/&quot;&gt;stackoverflow&lt;/a&gt; came into the mix :)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;D:\Readify\Hg\ReadifySample\src&amp;gt;&quot;C:\Program Files (x86)\Microsoft SDKs\Silverlight\v4.0\Tools\Slsvcutil.exe&quot; http://localhost:47862/Services/ParentService.svc

Process is terminated due to StackOverflowException.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;No configuration options set. No informative error message. Annoying.&lt;/p&gt;

&lt;p&gt;The solution, which was initially posted &lt;a href=&quot;http://blogs.msdn.com/b/silverlightws/archive/2010/04/30/workaround-for-stackoverflowexception-when-using-slsvcutil-exe.aspx&quot;&gt;here&lt;/a&gt; over a year ago, is to add in a configuration file alongside slsvcutil.exe, called &lt;strong&gt;slsvcutil.exe.config&lt;/strong&gt;, which will point to the neutral-culture assembly.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;configuration&amp;gt;
  &amp;lt;satelliteassemblies&amp;gt;
    &amp;lt;assembly name=&quot;SlSvcUtil, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot; /&amp;gt;
  &amp;lt;/satelliteassemblies&amp;gt;
&amp;lt;/configuration&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That's right. If you have set your system language to something &lt;strong&gt;other than US English&lt;/strong&gt;, you will probably encounter this issue.&lt;/p&gt;

&lt;p&gt;Enjoy.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Musing - Simpler UI Testing for WPF Apps</title>
      <link>http://brendanforster.comsimpler-ui-testing-for-wpf-apps.html</link>
      <pubDate>Sat, 26 Mar 2011 14:00:00 +1100</pubDate>
      <author>shift.key@gmail.com (Brendan Forster)</author>
      <guid>http://brendanforster.com./simpler-ui-testing-for-wpf-apps</guid>
      <description>&lt;p&gt;After spending some time this week getting to know Ruby and some of its testing frameworks (Shoulda, rspec, and TestCase), I thought I'd put pen
to paper and revisit why I started down this path.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Some background&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;The current project I am working on is a large data-driven WPF application, with a lot of complex scenarios to
identify, develop and test. There is a group of testers on the project, but I can see an opportunity to use
automated testing to verify functionality and allow testers to focus on areas of better value - exploratory testing, for example.&lt;/p&gt;

&lt;p&gt;Yes, there are frameworks like &lt;a href=&quot;http://white.codeplex.com/&quot;&gt;White&lt;/a&gt; or Coded UI Tests, but these tools were designed with developers in mind.
You have to write code like &lt;a href=&quot;http://msdn.microsoft.com/en-us/magazine/dd483216.aspx&quot;&gt;this&lt;/a&gt; to drive the tests, and the tests are commonly written after the feature is implemented.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Enter Automated Acceptance Testing&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;In an ideal world, business users would define tests in an English-like language, which can then be translated into an executable
script and run against the application.&lt;/p&gt;

&lt;p&gt;What I'm looking for in a framework for defining use cases:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;define the test first, so that the high-level scenario is set before development occurs&lt;/li&gt;
&lt;li&gt;flexible with syntax for test cases - tailor scripts to suit people involved, while remaining declarative&lt;/li&gt;
&lt;li&gt;integrate into deployment process to verify builds automated&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;strong&gt;Some inspiration from obscure corners&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;When I first saw the syntax for &lt;a href=&quot;http://msdn.microsoft.com/en-us/magazine/dd483216.aspx&quot;&gt;webrat&lt;/a&gt;, I was intrigued and jealous. To declare a test like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;class SignupTest &amp;lt; ActionController::IntegrationTest

    def test_trial_account_sign_up
        visit home_path
        click_link &quot;Sign up&quot;
        fill_in &quot;Email&quot;, :with =&amp;gt; &quot;good@example.com&quot;
        select &quot;Free account&quot;
        click_button &quot;Register&quot;
    end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;was not far off what I'd had in mind for something that was easy to follow and easy to write.&lt;/p&gt;

&lt;p&gt;So I spent some time this week experimenting with various ways of achieving this against a sample WPF application.&lt;/p&gt;

&lt;p&gt;I'm using rspec at the moment to run the test cases, and IronRuby and White to support the integration with the hosted WPF application.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;What does a test for the WPF application look like?&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;describe &quot;new customers screen&quot; do

    subject { Host.new(File.expand_path('./app/WpfTestApp.exe', File.dirname(__FILE__)))

    before(:each) do
        click &quot;Add Customer&quot;
    end

    it &quot;cannot save empty form&quot; do
        cannot_click &quot;Save&quot;
        can_click &quot;Cancel&quot;
    end

    it &quot;can enter details for customer&quot; do
        fill &quot;FirstName&quot;, :with =&amp;gt; &quot;Brendan&quot;
        fill &quot;LastName&quot;, :with =&amp;gt; &quot;Forster&quot;
        # and some other fields
        can_click &quot;Save&quot;
    end

    it &quot;can save and return to main screen&quot; do
        fill &quot;FirstName&quot;, :with =&amp;gt; &quot;Brendan&quot;
        fill &quot;LastName&quot;, :with =&amp;gt; &quot;Forster&quot;
        # and some other fields
        click &quot;Save&quot;
        assert_title &quot;Dashboard&quot;
    end

    after(:each) do
        cleanup
    end

    def method_missing(sym, *args, &amp;amp;block)
        subject.send sym, *args, &amp;amp;block
    end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The fields used here are based off the UI Automation features of the .NET Framework (some reading &lt;a href=&quot;http://white.codeplex.com/&quot;&gt;here&lt;/a&gt; on recommendations)
which I'll dig into a bit later if people are interested.&lt;/p&gt;

&lt;p&gt;The method_missing method is used to reduce the noise of writing &quot;subject.&quot; to start each line - I'm not quite sold on the approach, but it was cleaner than the previous approaches I'd tried.
Also, rspec has a &lt;a href=&quot;https://gist.github.com/663876&quot;&gt;huge set of features&lt;/a&gt; which I've barely scratched the surface on.&lt;/p&gt;

&lt;p&gt;So with a set of files like the file above, the testrunner is a simple script to load specific files found in the current directory:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;require 'rubygems'
require 'rspec'
require 'host'

Dir[File.dirname(__FILE__) + '/*tests.rb'].each do |file| 
    load file
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I'll share some more as I polish additional features (I'm most certainly doing Ruby wrong at the moment, so I keep refactoring code),
just needed to write this post.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Arguments about Project Structure</title>
      <link>http://brendanforster.comarguments-about-project-structure.html</link>
      <pubDate>Wed, 23 Feb 2011 14:00:00 +1100</pubDate>
      <author>shift.key@gmail.com (Brendan Forster)</author>
      <guid>http://brendanforster.com./arguments-about-project-structure</guid>
      <description>&lt;p&gt;Whenever it comes time to kick off a new project, how do you structure it?&lt;/p&gt;

&lt;p&gt;Given a greenfields situation - or even one of my side projects - I go for this layout:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;build&lt;/li&gt;
&lt;li&gt;lib&lt;/li&gt;
&lt;li&gt;licenses&lt;/li&gt;
&lt;li&gt;samples&lt;/li&gt;
&lt;li&gt;src

&lt;ul&gt;
&lt;li&gt;Project.ModuleA&lt;/li&gt;
&lt;li&gt;Project.ModuleB&lt;/li&gt;
&lt;li&gt;Project.Shell&lt;/li&gt;
&lt;li&gt;Project.sln&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;tools&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And what do those these folders represent?&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;build&lt;/strong&gt; - scripts for building and deploying the application. As soon as the application is required to be deployed to different environments, this should be scripted and added to source control.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;lib&lt;/strong&gt; - dependencies required by the application. I generally group the dependent assemblies if required, but will generally drop the dll-xml combination into the root folder.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;licenses&lt;/strong&gt; - when doing OSS development, this is a must. I should bring this into my general projects, especially if it has a significant mix of dependencies and licenses to manage.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;samples&lt;/strong&gt; - once the main solution gets beyond a specific size, it may be beneficial to separate the sample code out rather than compiling it within the main build.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;src&lt;/strong&gt; - there be code.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;tools&lt;/strong&gt; - dependencies required to build the application. This does not mean including every tool required to set up the developer baseline, but any special tools used during the build process&lt;/p&gt;

&lt;p&gt;For example, these would not belong:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Visual Studio&lt;/li&gt;
&lt;li&gt;.NET Framework&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;But I'd happily include these tools:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;FxCop&lt;/li&gt;
&lt;li&gt;NCover&lt;/li&gt;
&lt;li&gt;MSBuild Community Tasks&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;as not all developers would have them installed on their machines.&lt;/p&gt;

&lt;h2&gt;Why this structure?&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Folder Names&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Remember the days of 8.3 filesystems? I do. But thankfully this isn't about that.&lt;/p&gt;

&lt;p&gt;This structure also borrows from Unix conventions for arranging their codebases. I don't like how the necessary make files are hosted at the root.&lt;/p&gt;

&lt;p&gt;As we're using Mercurial, we don't need to worry about using trunks or tags in the structure.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Experience&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;When I challenged &lt;a href=&quot;http://twitter.com/aeoth&quot;&gt;@aeoth's&lt;/a&gt; project structure for the next version of MahTweets, he wanted to make it so that a developer with little experience in .NET (or programming) could download the source and try it out.&lt;/p&gt;

&lt;p&gt;I'd argue the best introduction to a codebase is two things:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;a README file to provide some notes about the application&lt;/li&gt;
&lt;li&gt;a batch file or script to run the application and execute tests&lt;/li&gt;
&lt;li&gt;sample projects to complement the source&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;strong&gt;The build is important&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;We had various pain points with the last version of MahTweets around managing loosely-coupled modules under development, and then building a signed ClickOnce installer with a custom script.&lt;/p&gt;

&lt;p&gt;It ended up being a painful few nights bashing against MSBuild (have you ever tried to use SignFile manually?), but the effort burnt reminds me everytime I come across a new team or project to ask two simple questions:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;how can someone build and run the application with limited knowledge of the codebase?&lt;/li&gt;
&lt;li&gt;how can someone test the application with limited knowledge of the codebase?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If that process is known and documented, it highlights all the quirks with getting the application out. If it isn't documented, then typically you need to find the right person at the right time...&lt;/p&gt;

&lt;p&gt;Putting the build components separate, but easily visible, makes everyone's life easier.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Habit&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;And lastly, this is my personal opinion. Having spent a lot of time playing around with Linux OSS in the past, I keep coming back to that style of structure when setting up my own projects. Seeing things like uppercase folder names at the root just feel odd.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Using Rx to Implement Filtering in MahTweets</title>
      <link>http://brendanforster.comusing-rx-to-implement-filtering-in-mahtweets.html</link>
      <pubDate>Sat, 19 Feb 2011 14:00:00 +1100</pubDate>
      <author>shift.key@gmail.com (Brendan Forster)</author>
      <guid>http://brendanforster.com./using-rx-to-implement-filtering-in-mahtweets</guid>
      <description>&lt;p&gt;As we're kicking development off for the next version of MahTweets in the coming weeks, the team has been looking at experimenting with new technology and bringing the most useful stuff into the application.&lt;/p&gt;

&lt;p&gt;Filtering is one of the things that MahTweets is famous for, but we're always looking for ways to make it better and easier. We've been experimenting with using the &lt;a href=&quot;http://msdn.microsoft.com/en-us/devlabs/ee794896&quot;&gt;Reactive Extensions (Rx) for .NET&lt;/a&gt; to simplify the entire pipeline and provide more freedom in the application.&lt;/p&gt;

&lt;h2&gt;The Current Status&lt;/h2&gt;

&lt;p&gt;MahTweets allow the user to filter streams by update type, contact or text. Filters can be applied to individual streams or globally.&lt;/p&gt;

&lt;p&gt;Roughly speaking, this is how the filters are applied.&lt;/p&gt;

&lt;center&gt;&lt;a href=&quot;img/posts/FiltersClassic.png&quot;&gt;&lt;img src=&quot;img/posts/FiltersClassic.png&quot; width=&quot;700&quot; /&gt;&lt;/a&gt;&lt;/center&gt;


&lt;p&gt;Updates from external services are added to the queue, which then raises CollectionChangedEvent notifications to each views. The view is responsible for running an update through its configured filters.&lt;/p&gt;

&lt;p&gt;Limitations about this approach:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Global Ignores were implemented separately.&lt;/li&gt;
&lt;li&gt;Custom filtering was implemented per update type.&lt;/li&gt;
&lt;li&gt;UI was coupled to stream container and specific parameters.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;First Cut using Rx&lt;/h2&gt;

&lt;p&gt;FYI: If you're not familiar with the Observer Pattern, check out the &lt;a href=&quot;http://en.wikipedia.org/wiki/Observer_pattern&quot;&gt;Wikipedia article&lt;/a&gt; for starters. Rx uses the Observer pattern heavily.&lt;/p&gt;

&lt;p&gt;We had a habit of using the phrase &quot;filter&quot; in many places of the application. To clarify our intent, we introduced two specific interfaces:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;IStatusSubscriber&lt;/strong&gt; - an extension which subscribes to a stream of incoming requests.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;IConditionalSubscriber&lt;/strong&gt; : &lt;strong&gt;IStatusSubscriber&lt;/strong&gt; - an extension which filters the updates before propogating to its consumers. Pass-thru or exclude filters can be specified.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Replacing the Queue of messages with an IObservable/IObserver dual allows the application to leverage the Subject&amp;lt;T&amp;gt; class to manage the interactions between the services and the clients. This class resides in System.Reactive.dll and implements both IObservable&amp;lt;T&amp;gt; and IObserver&amp;lt;T&amp;gt;.&lt;/p&gt;

&lt;p&gt;MahTweets also had some demo plugins for stream analytics, and abstracting away the queue support allows the application to plug in additional &quot;global&quot; services, using the same interfaces. Rx also allows observers to specify which thread to execute on, so the usage of the Dispatcher, TaskPool or ThreadPool (depending on scenario) can be configured without any plumbing code.&lt;/p&gt;

&lt;p&gt;The interactions between these components now looks like:&lt;/p&gt;

&lt;center&gt;&lt;a href=&quot;img/posts/RxFirstCut.png&quot;&gt;&lt;img src=&quot;img/posts/RxFirstCut.png&quot; width=&quot;700&quot; /&gt;&lt;/a&gt;&lt;/center&gt;


&lt;p&gt;The biggest change is that subscribers interact with the IObservable, rather than being encompassed within the view. Each list still combines a set of filters, which display the combined set of results on-screen. However, when multiple filters are run in parallel, invalid items may appear.&lt;/p&gt;

&lt;p&gt;Limitations about this approach:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Excluded updates may be propogated through other subscribers in the same view.&lt;/li&gt;
&lt;li&gt;Global Ignores still not supported.&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;Back to the Drawing Board&lt;/h2&gt;

&lt;p&gt;So after some shut-eye and sun, I revisited the initial design for the IObservable implementation. What stood out to me was that:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Include and exclude side-by-side has always been somewhat complex - both for users to understand, and determining which takes priority.&lt;/li&gt;
&lt;li&gt;Include and exclude filters didn't need to exist in the same location.&lt;/li&gt;
&lt;li&gt;Rx can support chaining observers, however...&lt;/li&gt;
&lt;li&gt;Chaining isn't what the Observer pattern is about.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;After some more musing, I formed an opinion about subscriber rules (only mine so far):&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;An exclude rule is applied globally. An include rule is applied locally.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;From my experiences with using Twitter, the typical use cases for exclude filters are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&quot;Great, another Twitter spam concept...&quot; &lt;em&gt;looks at paper.li&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&quot;Person XYZ is tweeting too much right now. I don't want to hear him for a while...&quot;&lt;/li&gt;
&lt;li&gt;&quot;Oops, I said the i-word and the spammers are out and about...&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;On the other hand, the use cases for include filters can be like:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&quot;I want to see what &lt;em&gt;this&lt;/em&gt; group of contacts is talking about...&quot;&lt;/li&gt;
&lt;li&gt;&quot;I want to see tweets mentioning 'ABC' - (side note: more on search later)...&quot;&lt;/li&gt;
&lt;li&gt;&quot;I want to see my mentions/messages...&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Compare and contract (perhaps your experiences differ).&lt;/p&gt;

&lt;h2&gt;Second Cut using Rx&lt;/h2&gt;

&lt;p&gt;The second cut of the design allows for three subscriber hooks:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Subscribers register against the source observable, without any filtering applied.&lt;/li&gt;
&lt;li&gt;Subscribers register against the output observable, with the global filtering applied.&lt;/li&gt;
&lt;li&gt;Exclude rules are applied closer to the source.&lt;/li&gt;
&lt;/ul&gt;


&lt;center&gt;&lt;a href=&quot;img/posts/RxSecondCut.png&quot;&gt;&lt;img src=&quot;img/posts/RxSecondCut.png&quot; width=&quot;700&quot; /&gt;&lt;/a&gt;&lt;/center&gt;


&lt;p&gt;An internal subscriber verifies a status against a list of exclusions, and propogates the status further if it is valid. Each view only requires its inclusion rules (or a wildcard rule if no rules specified) to display results.&lt;/p&gt;

&lt;h2&gt;The Next Step&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Debate with &lt;a href=&quot;http://twitter.com/aeoth&quot;&gt;@aeoth&lt;/a&gt; on this&lt;/li&gt;
&lt;li&gt;Performance Testing against a large set of data.&lt;/li&gt;
&lt;li&gt;Demonstrating how external plugins can include their own rules.&lt;/li&gt;
&lt;li&gt;Demonstrate user interface changes for vNext.&lt;/li&gt;
&lt;/ul&gt;

</description>
    </item>
    
    <item>
      <title>WP7 - Memory Profiling Adventures - Navigation (Updated)</title>
      <link>http://brendanforster.comwp7-memory-profiling-navigation.html</link>
      <pubDate>Fri, 04 Feb 2011 14:00:00 +1100</pubDate>
      <author>shift.key@gmail.com (Brendan Forster)</author>
      <guid>http://brendanforster.com./wp7-memory-profiling-navigation</guid>
      <description>&lt;p&gt;In the course of wrapping up a SL-based WP7 application recently, I stumbled across a significant hurdle with memory consumption on the device...&lt;/p&gt;

&lt;h2&gt;Updated&lt;/h2&gt;

&lt;p&gt;After going back and forth with local Windows Phone guru &lt;a href=&quot;http://nicksnettravels.builttoroam.com/&quot;&gt;Nick Randolph&lt;/a&gt; about the issue, and he &lt;a href=&quot;http://nicksnettravels.builttoroam.com/blogengine/post/2011/02/10/Windows-Phone-7-Navigation-Memory-Usage.aspx&quot;&gt;blogged&lt;/a&gt; &lt;a href=&quot;http://nicksnettravels.builttoroam.com/blogengine/post/2011/02/10/Windows-Phone-7-Navigation-Memory-Usage-Just-Got-Scary.aspx&quot;&gt;about&lt;/a&gt; the behaviour in more detail, we came to the conclusion that the garbage collection was not being triggered automatically. That's not necessarily a bad thing (see the &lt;a href=&quot;http://nicksnettravels.builttoroam.com/blogengine/post/2011/02/10/Windows-Phone-7-Navigation-Memory-Usage-Just-Got-Scary.aspx&quot;&gt;conditions for triggering a garbage collection&lt;/a&gt; here) but is a concern for large WP7 applications.&lt;/p&gt;

&lt;p&gt;The workaround I devised for this is to trigger a GC.Collect() after a number of page navigations. I would only add this to an application when absolutely necessary. The implementation of this I'll leave as an exercise to the reader.&lt;/p&gt;

&lt;p&gt;Side note: I've seen various samples floating around which will use a timer to invoke a garbage collection call. Ignoring the use of timers on the device (which will drain the battery), a garbage collection call at an arbitrary time will likely impact on the user experience. Be smart about it, if you need to work this into an application.&lt;/p&gt;

&lt;p&gt;Read on for the rest of the saga...&lt;/p&gt;

&lt;h2&gt;Before We Begin...&lt;/h2&gt;

&lt;p&gt;One of the requirements a WP7 application needs to satisfy is around memory consumption&lt;/p&gt;

&lt;h3&gt;5.2.5 Memory Consumption&lt;/h3&gt;


&lt;p&gt;&lt;em&gt;An application must not exceed 90 MB of RAM usage, except on devices that have more than 256 MB of memory. You can use the &lt;strong&gt;DeviceExtendedProperties&lt;/strong&gt; class to query the amount of memory that is available on the device and modify the application behavior at runtime to take advantage of additional memory. For more information, see the DeviceExtendedProperties class in MSDN.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note:&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;The DeviceTotalMemory value returned by &lt;strong&gt;DeviceExtendedProperties&lt;/strong&gt; indicates the physical RAM size in bytes. This value is less than the actual amount of device memory. For an application to pass certification, Microsoft recommends that the value returned by ApplicationPeakMemoryUsage is less than 90 MB when the DeviceTotalMemory is less than or equal to 256 MB&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Source &lt;a href=&quot;http://go.microsoft.com/?linkid=9730556&quot;&gt;Microsoft&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;90 MB sounds like a lot of space - and yes, it is, when one remembers the era of 1.44MB diskettes (or earlier) you can't help but think that perhaps we are spoiled - but what can you do with that amount of memory?&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt; - Disregard the &quot;devices with &gt; 256MB&quot; exception mentioned, as I want to see how we can optimise memory usage on SL without sacrificing features.&lt;/p&gt;

&lt;h2&gt;How Do I Work Out My Memory Usage?&lt;/h2&gt;

&lt;p&gt;As mentioned above, the &lt;strong&gt;DeviceExtendedProperties&lt;/strong&gt; class contains a lot of runtime information about the application.&lt;/p&gt;

&lt;p&gt;I drop this method into the App.xaml.cs class so that I can get statistics at any point of the application's lifecycle.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;public static void GetMemoryUsage(string task)
{
    var number = (long)DeviceExtendedProperties.GetValue(&quot;ApplicationCurrentMemoryUsage&quot;);
    Debug.WriteLine(&quot;{0} - ApplicationCurrentMemoryUsage: {1}&quot;, task, number);
    number = (long)DeviceExtendedProperties.GetValue(&quot;ApplicationPeakMemoryUsage&quot;);
    Debug.WriteLine(&quot;{0} - ApplicationPeakMemoryUsage: {1}&quot;, task, number);

    Debug.WriteLine(&quot;&quot;);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Oh, and don't forget the namespace&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;using Microsoft.Phone.Info;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This allows parts of the application to log diagnostics, like:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;private void MainPageLoaded(object sender, RoutedEventArgs e)
{
    if (!App.ViewModel.IsDataLoaded)
        App.ViewModel.LoadData();

    App.GetMemoryUsage(&quot;Main - Loaded&quot;);

}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;and see a message like in the Output Window:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Main - Loaded - ApplicationCurrentMemoryUsage: 39870464
Main - Loaded - ApplicationPeakMemoryUsage: 39899136
&lt;/code&gt;&lt;/pre&gt;

&lt;h2&gt;And now things get interesting...&lt;/h2&gt;

&lt;p&gt;Testing out a simple application - two screens, both use the Panorama Control and independent ViewModels which display a &quot;large&quot; list of items (270-ish items, but text only).&lt;/p&gt;

&lt;p&gt;Selecting an item in the main screen will navigate to the second screen. Pressing back will return the application to the main screen.&lt;/p&gt;

&lt;p&gt;The code is &lt;a href=&quot;http://brendanforster.com/get/panoramasample.zip&quot;&gt;here&lt;/a&gt; and the sample output can be seen on &lt;a href=&quot;https://gist.github.com/812178&quot;&gt;Gist&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Graphing the memory at each step, the graph looks like this:&lt;/p&gt;

&lt;center&gt;&lt;a href=&quot;img/posts/breakdown.png&quot;&gt;&lt;img src=&quot;img/posts/breakdown.png&quot; width=&quot;800&quot; /&gt;&lt;/a&gt;&lt;/center&gt;


&lt;p&gt;But why is the memory footprint larger (by almost 10 MB) on returning to the main screen?&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Removing the Panorama Control did not change this behaviour - it just made the numbers smaller (a 5MB difference rather than 10MB). Just a sign that making screens leaner will certainly assist with reducing the overall footprint, but not the answer I was looking for.&lt;/p&gt;

&lt;p&gt;Repeating the scenario a few times, and the behaviour is the same.&lt;/p&gt;

&lt;center&gt;&lt;a href=&quot;img/posts/pattern.png&quot;&gt;&lt;img src=&quot;img/posts/pattern.png&quot; width=&quot;800&quot; /&gt;&lt;/a&gt;&lt;/center&gt;


&lt;p&gt;Puzzling...&lt;/p&gt;

&lt;h2&gt;And the adventure begins&lt;/h2&gt;

&lt;p&gt;The underlying &lt;em&gt;why&lt;/em&gt; is what I want to understand more. Even with this simple application - which is displaying a large list of items - the size of the application is already close to the 90MB limit.&lt;/p&gt;

&lt;p&gt;I've only been able to throw a couple of hours of spare time at this so far, but here's some notes from my investigation currently:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Tested this with the &lt;a href=&quot;http://windowsteamblog.com/windows_phone/b/wpdev/archive/2011/02/04/windows-phone-developer-tools-january-update.aspx&quot;&gt;new emulator and SDK changes&lt;/a&gt;. No change to the behaviour.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Haven't found any memory profiling tools for SL &amp;amp; WP7 - if anyone has stuff in the works, I'd love to try them out. &lt;a href=&quot;http://eqatec.com/Profiler/Overview.aspx&quot;&gt;EQUATEC&lt;/a&gt; make a profiler for CPU performance, which works wonderfully from my limited testing.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Aggressive garbage collection helped somewhat, but this approach makes me feel unclean. Using timers on the device to trigger a GC Collect is bad for battery performance, and the demo above shows that memory usage can spike between events for a PhoneApplicationPage.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Paging data from isolated storage could be worth attempting, but I don't think this is a temporary fix - as the application would load the full file, select a subset of the data, and then dispose the file. Chunking data in isolated storage would increase complexity.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Avoiding the use of navigation - and rolling some custom controls to support transitions instead - is the method that needs most work, but gives more control back to the application.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
    </item>
    
    <item>
      <title>MEF and Chaining Dependencies</title>
      <link>http://brendanforster.commef-and-chaining-dependencies.html</link>
      <pubDate>Mon, 20 Dec 2010 14:00:00 +1100</pubDate>
      <author>shift.key@gmail.com (Brendan Forster)</author>
      <guid>http://brendanforster.com./mef-and-chaining-dependencies</guid>
      <description>&lt;p&gt;A &lt;a href=&quot;http://mef.codeplex.com/Thread/View&quot;&gt;question&lt;/a&gt; came up on the MEF discussion board recently (today?) about how to handle a complex graph of dependencies. Although it was &quot;solved&quot; - and I suspect it was a case of missing the required assembly, going by what info was at hand - it still prompted me to dig into how one can go beyond the basics.&lt;/p&gt;

&lt;h2&gt;Scenario&lt;/h2&gt;

&lt;p&gt;Imagine you have an application that calls off different services to execute tasks. Rather than hard-coding the services into the application, these can be defined as parts which are composed at runtime using MEF.&lt;/p&gt;

&lt;p&gt;But the relationship between the application and the services is not straightforward, which gives a dependency graph similar to the below image:&lt;/p&gt;

&lt;center&gt;&lt;img src=&quot;img/posts/DependencyGraph.png&quot; height=&quot;500&quot;  /&gt;&lt;/center&gt;


&lt;p&gt;What should we do now?&lt;/p&gt;

&lt;p&gt;As MEF uses the concept of a &quot;contract&quot; to resolve the [Import] and [Export]; statements sprinkled within an application, this ultimately comes down to two similar approaches.&lt;/p&gt;

&lt;h2&gt;Using Contract Names&lt;/h2&gt;

&lt;p&gt;If the Proxy and Service implementations are equivalent - so we can avoid using distinct interfaces for behaviour which is identical - then we can use the same interface and specify a different contract for each extensibiity point defined in the application.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;public class ConsumingApplication
{
    [ImportMany(&quot;Contoso.Application&quot;, typeof(IServiceProxy))]
    public IEnumerable&amp;amp;lt;IServiceProxy&amp;amp;gt; Services { get; set; }

    // implementation here
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And our simple client can use the corresponding [Export] statement.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[Export(&quot;Contoso.Application&quot;, typeof(IServiceProxy))]
public class StandaloneProxy : IServiceProxy
{
    // implementation here 
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Our complex dependency has a bit more code, but it can be broken down into two main features:&lt;/p&gt;

&lt;p&gt;The contract which it satisfies - &lt;strong&gt;Contoso.Application&lt;/strong&gt; and &lt;strong&gt;IServiceProxy&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;The contract which it requires - &lt;strong&gt;Contoso.External&lt;/strong&gt; and &lt;strong&gt;IServiceProxy&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[Export(&quot;Contoso.Application&quot;, typeof(IServiceProxy))]
public class ActualProxy : IServiceProxy
{
    [ImportMany(&quot;Contoso.External&quot;)]
    public IEnumerable&amp;amp;lt;IServiceProxy&amp;amp;gt; Services { get; set; }

    // implementation here
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So while reusing the same interface, we can specify &lt;em&gt;how&lt;/em&gt; the parts relate.&lt;/p&gt;

&lt;h2&gt;Using Contract Types&lt;/h2&gt;

&lt;p&gt;If the behaviour of the proxy and the actual service are different, then we can just use the types to represent the contract.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;public class ConsumingApplication
{
    [ImportMany(typeof(IServiceProxy))]
    public IEnumerable&amp;amp;lt;IServiceProxy&amp;amp;gt; Services { get; set; }

    // implementation here
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The exported contract becomes:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[Export(typeof(IServiceProxy))]
public class StandaloneProxy : IServiceProxy
{
    // implementation here
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And our complex part still has two contracts:&lt;/p&gt;

&lt;p&gt;The contract which it satisfies - the &lt;strong&gt;IServiceProxy&lt;/strong&gt; contract.&lt;/p&gt;

&lt;p&gt;The contract which it requires - the &lt;strong&gt;IService&lt;/strong&gt; contract (implicit due to the awesomeness of ImportMany)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[Export(typeof(IServiceProxy))]
public class ActualProxy : IServiceProxy
{
    [ImportMany]
    public IEnumerable&amp;amp;lt;IService&amp;amp;gt; Services { get; set; }

    // implementation here
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;No more magic strings, while still being able to declare&lt;/p&gt;

&lt;h2&gt;And finally, InheritedExport&lt;/h2&gt;

&lt;p&gt;To really simplify the contracts, you can use [InheritedExport] on the interface. This declares to MEF that all types which implement the interface should be used as exported parts, using the interface type as the contract.&lt;/p&gt;

&lt;p&gt;So I annotate both interfaces:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[InheritedExport]
public interface IServiceProxy
{
    // code here
}

&amp;amp;#91;InheritedExport&amp;amp;#92;
public interface IService
{
    // code here
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;and can eliminate all other [Export] attributes from the codebase:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;public class StandaloneProxy : IServiceProxy
{
    // implementation here
}

public class ActualProxy : IServiceProxy
{
    [ImportMany]
    public IEnumerable&amp;amp;lt;IService&amp;amp;gt; Services { get; set; }

    // implementation here
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;
</description>
    </item>
    

  </channel>
</rss>